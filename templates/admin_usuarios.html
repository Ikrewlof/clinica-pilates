{% extends "base.html" %}
{% block title %}Usuarios{% endblock %}

{% block content %}
<h2>Gestión de usuarios</h2>

<div style="margin: 10px 0 16px 0;">
    <a href="/pilates/admin/usuarios?estado=activos"
       class="boton {% if estado=='activos' %}boton-primario{% else %}boton-secundario{% endif %}">
        ✅ Activos
    </a>

    <a href="/pilates/admin/usuarios?estado=desactivados"
       class="boton {% if estado=='desactivados' %}boton-primario{% else %}boton-secundario{% endif %}">
        ⛔ Desactivados
    </a>

    <a href="/pilates/admin/usuarios?estado=todos"
       class="boton {% if estado=='todos' %}boton-primario{% else %}boton-secundario{% endif %}">
        📋 Todos
    </a>

    <a href="/pilates/admin" class="boton boton-secundario">⬅ Volver al panel</a>

</div>




<table>
    <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th>Clases / semana</th>
        <th>Acciones</th>
    </tr>

    {% for u in usuarios %}
    <tr>
        <form method="post" action="/pilates/admin/usuarios/editar/{{ u[0] }}">
        <td>
            <input type="text" name="nombre" value="{{ u[1] }}" required>
        </td>

        <td>{{ u[2] }}</td>

        <td>
            <select name="rol">
                <option value="usuario" {% if u[3]=="usuario" %}selected{% endif %}>
                    Usuario
                </option>

                <option value="admin" {% if u[3]=="admin" %}selected{% endif %}>
                    Admin
                </option>

           
        </td>

        <td>
            <select name="clases_semana">
                <option value="0" {% if u[4]==0 %}selected{% endif %}>0</option>
                <option value="1" {% if u[4]==1 %}selected{% endif %}>1</option>
                <option value="2" {% if u[4]==2 %}selected{% endif %}>2</option>
            </select>
        </td>

        <td class="acciones">
            <button type="submit">💾 Guardar</button>
            </form>

            <form method="post"
                  action="/pilates/admin/usuarios/password/{{ u[0] }}"
                  style="display:inline;">
                <button type="submit">🔐 Password</button>
            </form>



            {% if u[5] == 1 %}
            <!-- USUARIO DESACTIVADO → MOSTRAR ACTIVAR -->
            <form method="post"
                  action="/pilates/admin/usuarios/activar/{{ u[0] }}"
                  style="display:inline;"
                  onsubmit="return confirm('¿Deseas ACTIVAR este usuario?');">
                <button class="boton-verde">✅ Activar</button>
            </form>
            {% else %}
            <!-- USUARIO ACTIVO → MOSTRAR DESACTIVAR -->
            <form method="post"
                  action="/pilates/admin/usuarios/desactivar/{{ u[0] }}"
                  style="display:inline;"
                  onsubmit="return confirm('¿Deseas DESACTIVAR este usuario?');">
                <button class="boton-rojo">❌ Desactivar</button>
            </form>
            {% endif %}

            <form method="post"
                  action="/pilates/admin/usuarios/eliminar/{{ u[0] }}"
                  style="display:inline;"
                  onsubmit="return confirm('¿Eliminar este usuario definitivamente?');">
                <button class="boton-rojo">🗑 Eliminar</button>
            </form>


        </td>
    </tr>
    {% endfor %}
</table>

<br>
<a href="/pilates/admin" class="boton boton-secundario">⬅ Volver al panel</a>
{% endblock %}
