{% extends "base.html" %}
{% block title %}Histórico de pagos{% endblock %}

{% block content %}

<h2>Histórico de pagos</h2>

<form method="get" class="selector-mes">
    <label>Mes:</label>

    <input type="month"
           name="mes"
           value="{% if year and month %}{{ '%04d-%02d'|format(year, month) }}{% endif %}">

    <button type="submit">Filtrar</button>
    <a href="/admin" class="boton boton-secundario">⬅ Volver al panel</a>


</form>

{% if resumen %}
<div class="menu-bloque" style="margin: 15px 0;">
    <h3>📊 Resumen del mes</h3>

    <p><strong>Total:</strong> {{ "%.2f"|format(resumen.total_pagado) }} €</p>
    <p><strong>Pagado Efectivo:</strong> {{ "%.2f"|format(resumen.total_efectivo) }} €</p>
    <p><strong>Pagado TPV:</strong> {{ "%.2f"|format(resumen.total_tpv) }} €</p>


</div>
{% endif %}

<table>
    <tr>
        <th>Usuario</th>
        <th>Mes</th>
        <th>Año</th>
        <th>Cuota</th>
        <th>Metodo pago</th>
        <th>Estado</th>
        <th>Fecha de pago</th>
    </tr>

    {% for id, nombre, year, month, cuota, metodo_pago, pagado, fecha in pagos %}
    <tr class="{% if not pagado %}fila-roja{% endif %}">
        <td>{{ nombre }}</td>

        <td>{{ mes_literal }}</td>

        <td>{{ year }}</td>

        <td>{{ cuota }} €</td>

        <td>{{ metodo_pago }}</td>


        <td>
            {% if pagado %}
            ✅ Pagado
            {% else %}
            ❌ Pendiente
            {% endif %}
        </td>

        <td>
            {% if fecha %}
            {{ fecha[8:10] }}-{{ fecha[5:7] }}-{{ fecha[0:4] }}
            {% else %}
            —
            {% endif %}
        </td>
    </tr>
    {% else %}
    <tr>
        <td colspan="5" style="text-align:center; font-style:italic;">
            No hay pagos para este filtro
        </td>
    </tr>
    {% endfor %}
</table>

<a href="/admin" class="boton boton-secundario">⬅ Volver al panel</a>

{% endblock %}
